#include "stdafx.h"
#include "TaxCalc.h"

#define	MAX_VAT_CNT	97
VAT_TABLE_T	VATTBL[MAX_VAT_CNT] = {
	{30000   ,49999   , 2000 },
	{50000   ,74999   , 3000 },
	{75000   ,99999   , 5000 },
	{100000  ,124999  , 7000 },
	{125000  ,149999  , 8000 },
	{150000  ,174999  , 9000 },
	{175000  ,199999  ,10000 },
	{200000  ,224999  ,12000 },
	{225000  ,249999  ,13000 },
	{250000  ,274999  ,15000 },
	{275000  ,299999  ,17000 },
	{300000  ,324999  ,19000 },
	{325000  ,349999  ,21000 },
	{350000  ,374999  ,23000 },
	{375000  ,399999  ,25000 },
	{400000  ,424999  ,27000 },
	{425000  ,449999  ,28000 },
	{450000  ,474999  ,30000 },
	{475000  ,499999  ,32000 },
	{500000  ,549999  ,35000 },
	{550000  ,599999  ,37000 },
	{600000  ,649999  ,41000 },
	{650000  ,699999  ,45000 },
	{700000  ,749999  ,50000 },
	{750000  ,799999  ,53000 },
	{800000  ,849999  ,57000 },
	{850000  ,899999  ,60000 },
	{900000  ,949999  ,65000 },
	{950000  ,999999  ,68000 },
	{1000000 ,1099999 ,75000 },
	{1100000 ,1199999 ,80000 },
	{1200000 ,1299999 ,90000 },
	{1300000 ,1399999 ,95000 },
	{1400000 ,1499999 ,105000},
	{1500000 ,1599999 ,110000},
	{1600000 ,1699999 ,115000},
	{1700000 ,1799999 ,127000},
	{1800000 ,1899999 ,135000},
	{1900000 ,1999999 ,140000},
	{2000000 ,2099999 ,150000},
	{2100000 ,2199999 ,155000},
	{2200000 ,2299999 ,160000},
	{2300000 ,2399999 ,170000},
	{2400000 ,2499999 ,177000},
	{2500000 ,2599999 ,185000},
	{2600000 ,2699999 ,190000},
	{2700000 ,2799999 ,200000},
	{2800000 ,2899999 ,210000},
	{2900000 ,2999999 ,215000},
	{3000000 ,3099999 ,225000},
	{3100000 ,3199999 ,230000},
	{3200000 ,3299999 ,235000},
	{3300000 ,3399999 ,240000},
	{3400000 ,3499999 ,250000},
	{3500000 ,3599999 ,260000},
	{3600000 ,3699999 ,270000},
	{3700000 ,3799999 ,280000},
	{3800000 ,3899999 ,285000},
	{3900000 ,3999999 ,290000},
	{4000000 ,4099999 ,300000},
	{4100000 ,4199999 ,310000},
	{4200000 ,4299999 ,315000},
	{4300000 ,4399999 ,320000},
	{4400000 ,4499999 ,333000},
	{4500000 ,4599999 ,340000},
	{4600000 ,4699999 ,350000},
	{4700000 ,4799999 ,360000},
	{4800000 ,4899999 ,370000},
	{4900000 ,4999999 ,380000},
	{5000000 ,5099999 ,390000},
	{5100000 ,5199999 ,400000},
	{5200000 ,5299999 ,410000},
	{5300000 ,5399999 ,420000},
	{5400000 ,5499999 ,430000},
	{5500000 ,5599999 ,440000},
	{5600000 ,5699999 ,450000},
	{5700000 ,5799999 ,460000},
	{5800000 ,5899999 ,470000},
	{5900000 ,5999999 ,480000} };

#define	MAX_VAT220_CNT	46
VAT_TABLE_T	VATTBL220[MAX_VAT220_CNT] = {
	{ 2200001  ,2249999, 170000},
	{ 2250000  ,2299999, 190000},
	{ 2300000  ,2349999, 200000},
	{ 2350000  ,2399999, 210000},
	{ 2400000  ,2449999, 220000},
	{ 2450000  ,2499999, 230000},
	{ 2500000  ,2549999, 250000},
	{ 2550000  ,2599999, 260000},
	{ 2600000  ,2649999, 270000},
	{ 2650000  ,2699999, 280000},
	{ 2700000  ,2749999, 290000},
	{ 2750000  ,2799999, 300000},
	{ 2800000  ,2849999, 310000},
	{ 2850000  ,2899999, 320000},
	{ 2900000  ,2949999, 330000},
	{ 2950000  ,2999999, 350000},
	{ 3000000  ,3099999, 370000},
	{ 3100000  ,3199999, 400000},
	{ 3200000  ,3299999, 410000},
	{ 3300000  ,3399999, 450000},
	{ 3400000  ,3499999, 470000},
	{ 3500000  ,3599999, 490000},
	{ 3600000  ,3699999, 510000},
	{ 3700000  ,3799999, 530000},
	{ 3800000  ,3899999, 550000},
	{ 3900000  ,3999999, 570000},
	{ 4000000  ,4099999, 610000},
	{ 4100000  ,4199999, 650000},
	{ 4200000  ,4299999, 670000},
	{ 4300000  ,4399999, 690000},
	{ 4400000  ,4499999, 710000},
	{ 4500000  ,4599999, 730000},
	{ 4600000  ,4699999, 750000},
	{ 4700000  ,4799999, 770000},
	{ 4800000  ,4899999, 810000},
	{ 4900000  ,4999999, 830000},
	{ 5000000  ,5099999, 850000},
	{ 5100000  ,5199999, 870000},
	{ 5200000  ,5299999, 900000},
	{ 5300000  ,5399999, 950000},
	{ 5400000  ,5499999, 980000},
	{ 5500000  ,5599999,1000000},
	{ 5600000  ,5699999,1050000},
	{ 5700000  ,5799999,1070000},
	{ 5800000  ,5899999,1080000},
	{ 5900000  ,5999999,1100000} };

// 부가세로 환급액을 조회
int	getRefundAmt( int SellAmt )
{
	int first = 0;
	int last = MAX_VAT_CNT - 1;
	int middle = (first+last)/2;
	if( SellAmt < VATTBL[0].MinAmt || SellAmt > VATTBL[MAX_VAT_CNT].MaxAmt ) {
		AfxMessageBox("SellAmt is out of bound aborted..");
		return -1;
	}

	while (first <= last) {
		if (VATTBL[middle].MinAmt > SellAmt )
			last = middle - 1;    
		else if (VATTBL[middle].MinAmt <= SellAmt && VATTBL[middle].MaxAmt >= SellAmt ) {
			return VATTBL[middle].Refund;
			break;
		}
		else
			first = middle + 1;
 
		middle = (first + last)/2;
	}
	if (first > last) 
		AfxMessageBox("Tax Refund Search Failed..");
 
	return -1;
}

int	getRefundAmt220( int SellAmt )
{
	int first = 0;
	int last = MAX_VAT220_CNT - 1;
	int middle = (first+last)/2;

	if( SellAmt < VATTBL220[0].MinAmt || SellAmt > VATTBL220[MAX_VAT220_CNT].MaxAmt ) {
		AfxMessageBox("220 SellAmt is out of bound aborted..");
		return -1;
	}

	while (first <= last) {
		if (VATTBL220[middle].MinAmt > SellAmt )
			last = middle - 1;    
		else if (VATTBL220[middle].MinAmt <= SellAmt && VATTBL220[middle].MaxAmt >= SellAmt ) {
			return VATTBL220[middle].Refund;
			break;
		}
		else
			first = middle + 1;
 
		middle = (first + last)/2;
	}
	if (first > last) 
		AfxMessageBox("220 Tax Refund Search Failed..");
 
	return -1;
}
